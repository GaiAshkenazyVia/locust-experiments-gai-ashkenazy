version: '3'
services:
  master:
    container_name: master
    hostname: master
    ports:
     - "8089:8089"
     - "5557:5557"
     - "5558:5558"
    image: "grubykarol/locust:0.8.1-py3.6"
    environment:
      ATTACKED_HOST: http://master:8089
      LOCUST_MODE: master
      LOCUST_MASTER_BIND_PORT: 5557
      TASK_DELAY: 1000
      QUIET_MODE: "${QUIET_MODE:-false}"
      LOCUST_OPTS: "--no-web --expect-slaves 1 -c 1 -r 1 -n 3"
    volumes:
      - ./locust-scripts:/locust

  slave:
    image: "grubykarol/locust:0.8.1-py3.6"
    environment:
      ATTACKED_HOST: http://master:8089
      LOCUST_MODE: slave
      LOCUST_MASTER: master
      LOCUST_MASTER_BIND_PORT: 5557
      NO_PROXY: master
      TASK_DELAY: 1000
      QUIET_MODE: "${QUIET_MODE:-false}"
      LOCUST_OPTS: "--no-web -c 1 -r 1"
    volumes:
      - ./locust-scripts:/locust

  standalone:
    image: "grubykarol/locust:0.8.1-py3.6"
    container_name: standalone
    hostname: standalone
    ports:
     - "8189:8189"
    environment:
      ATTACKED_HOST: http://standalone:8189
      LOCUST_MODE: standalone
      NO_PROXY: standalone
      TASK_DELAY: 100
      QUIET_MODE: "${QUIET_MODE:-false}"
      LOCUST_OPTS: "--no-web -c 1 -r 1 -n 2"
    volumes:
      - ./locust-scripts:/locust
